(this["webpackJsonpscoobie-doobie-effector"]=this["webpackJsonpscoobie-doobie-effector"]||[]).push([[0],{78:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n(4),o=n.n(c),a=n(30),i=n.n(a),u=n(10),s=n(31),d=n.n(s),l=n(9),b=Object(c.createContext)(new Map),j=Object(c.createContext)((function(){})),f=function(){return Object(c.useContext)(b)},h=function(){return Object(c.useContext)(j)},v=function(e){if(!e.current)return null;var t=e.current,n=t.getAbsoluteTransform().copy();n.invert();var r=t.getStage().getPointerPosition();return r?n.point(r):null},O=function(e){var t=e.beginPos,n=e.endPos;return Object(r.jsx)(l.c,{x:t.x,y:t.y,width:n.x-t.x,height:n.y-t.y,fill:"blue",stroke:"red",opacity:.2})},x=function(e){var t,n=e.layoutSize,o=h(),a=Object(c.useState)({x:0,y:0}),i=Object(u.a)(a,2),s=i[0],d=i[1],b=Object(c.useState)(!1),j=Object(u.a)(b,2),f=j[0],x=j[1],g=Object(c.useRef)(null),p=Object(c.useRef)(0);return Object(r.jsx)(l.d,{className:"input-area",width:n.width,height:n.height,ref:g,onMouseDown:function(){var e;d(null!==(e=v(g))&&void 0!==e?e:{x:0,y:0}),x(!0)},onMouseUp:function(){x(!1),function(){var e,t=null!==(e=v(g))&&void 0!==e?e:{x:0,y:0};o((function(e){var n=Math.min(s.x,t.x),r=Math.min(s.y,t.y),c=Math.abs(s.x-t.x)+1,o=Math.abs(s.y-t.y)+1,a={cropX:n,cropY:r,cropWidth:c,cropHeight:o,x:n+c/2,y:r+o/2,width:c,height:o,scaleX:1,scaleY:1},i=new Map(e);return i.set(p.current,a),p.current++,i}))}()},children:Object(r.jsx)(l.b,{children:f?Object(r.jsx)(O,{beginPos:s,endPos:null!==(t=v(g))&&void 0!==t?t:{x:0,y:0}}):null})})},g=n(8),p=function(e){var t,n,o=e.currentFrame,a=e.boxProps,i=e.isSelected,u=e.onSelect,s=e.onChange,d=Object(c.useRef)(null),b=Object(c.useRef)(null);return Object(c.useEffect)((function(){var e,t,n;i&&(null===(e=b.current)||void 0===e||e.nodes([d.current]),null===(t=b.current)||void 0===t||null===(n=t.getLayer())||void 0===n||n.batchDraw())}),[i]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(l.a,Object(g.a)(Object(g.a)({ref:d,onClick:u,onDragEnd:function(e){s(Object(g.a)(Object(g.a)({},a),{},{x:e.target.x(),y:e.target.y()}))},onTransformEnd:function(){var e=d.current,t=e.scaleX(),n=e.scaleY();s(Object(g.a)(Object(g.a)({},a),{},{x:e.x(),y:e.y(),scaleX:t,scaleY:n}))}},a),{},{offset:{x:(null===(t=d.current)||void 0===t?void 0:t.width())/2,y:(null===(n=d.current)||void 0===n?void 0:n.height())/2},image:o,stroke:"black",strokeWidth:10,strokeScaleEnabled:!1,draggable:!0})),i&&Object(r.jsx)(l.e,{ref:b,rotateEnabled:!1,ignoreStroke:!0,padding:5})]})},y=function(e){var t=e.currentFrame,n=e.selectedKeyState,c=Object(u.a)(n,2),o=c[0],a=c[1],i=f(),s=h();return Object(r.jsxs)(l.b,{children:[Object(r.jsx)(l.a,{image:t,onMouseDown:function(){a(void 0)}}),Array.from(i).map((function(e){var n=Object(u.a)(e,2),c=n[0],d=n[1];return Object(r.jsx)(p,{boxProps:d,currentFrame:t,isSelected:c===o,onSelect:function(){a(c)},onChange:function(e){var t=new Map(i);t.set(c,e),s(t)}},c)}))]})},w=n(33),m=function(e){var t=e.selectedKeyState,n=Object(u.a)(t,2),c=n[0],o=n[1],a=h(),i=function(e){void 0!==c?a((function(t){var n=t.get(c);if(void 0===n)return console.error("Not Found"),t;var r=e(n);return new Map(t).set(c,r)})):console.error("No Boxes Selected")},s=function(e){return Object(g.a)(Object(g.a)({},e),{},{scaleX:-e.scaleX})},d=function(e){return Object(g.a)(Object(g.a)({},e),{},{scaleY:-e.scaleY})};return Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{onClick:function(){o(void 0)},disabled:void 0===c,children:"\u9078\u629e\u89e3\u9664"}),Object(r.jsx)("button",{onClick:function(){!function(){if(void 0===c)return console.error("No Boxes Selected"),null;a((function(e){var t=new Map(e);return t.delete(c)||console.error("Not Found"),t})),o(void 0)}()},disabled:void 0===c,children:"\u524a\u9664"})]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{onClick:function(){i(s)},disabled:void 0===c,children:"\u5de6\u53f3\u53cd\u8ee2"}),Object(r.jsx)("button",{onClick:function(){i(d)},disabled:void 0===c,children:"\u4e0a\u4e0b\u53cd\u8ee2"})]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{onClick:function(){void 0!==c?a((function(e){var t=e.get(c);if(!t)return console.error("Not Found"),new Map(e);var n=new Map(e);return n.delete(c),n.set(c,t),n})):console.error("No Boxes Selected")},disabled:void 0===c,children:"\u6700\u524d\u9762\u3078"}),Object(r.jsx)("button",{onClick:function(){void 0!==c?a((function(e){var t=e.get(c);return t?new Map([[c,t]].concat(Object(w.a)(Array.from(e)))):(console.error("Not Found"),new Map(e))})):console.error("No Boxes Selected")},disabled:void 0===c,children:"\u6700\u80cc\u9762\u3078"})]})]})},S=function(e){var t=e.layoutSize,n=e.baseCanvas,o=f(),a=h(),i=Object(c.useState)();return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(l.d,{className:"output-area",width:t.width,height:t.height,children:Object(r.jsx)(j.Provider,{value:a,children:Object(r.jsx)(b.Provider,{value:o,children:Object(r.jsx)(y,{currentFrame:n,selectedKeyState:i})})})}),Object(r.jsx)(m,{selectedKeyState:i})]})},M=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t},C={width:1280,height:720,facingMode:"user"},k=Object(g.a)({},C),P=function(){var e=Object(c.useState)(M(k)),t=Object(u.a)(e,2),n=t[0],o=t[1],a=Object(c.useState)(new Map),i=Object(u.a)(a,2),s=i[0],l=i[1],f=Object(c.useRef)(null),h=Object(c.useRef)();return Object(c.useEffect)((function(){return h.current=setInterval((function(){return function(e){if(f.current&&f.current.video){var t=M(e).getContext("2d");if(t){t.drawImage(f.current.video,0,0);var n=t.getImageData(0,0,e.width,e.height);!function(e){for(var t=e.data.length/4,n=0;n<t;n++){var r=.299*e.data[4*n+0]+.587*e.data[4*n+1]+.114*e.data[4*n+2],c=r*r/255/255;e.data[4*n+0]=255*(c+.008),e.data[4*n+1]=255*(c+.014)+1.9,e.data[4*n+2]=255*(c+.004)}}(n),t.putImageData(n,0,0),o(t.canvas)}}}(k)}),1e3/60),function(){clearInterval(h.current)}}),[60]),Object(r.jsxs)("section",{id:"app",children:[Object(r.jsx)(d.a,{id:"camera",ref:f,audio:!1,videoConstraints:C,width:k.width,height:k.height,style:{position:"absolute"}}),Object(r.jsx)(j.Provider,{value:l,children:Object(r.jsxs)(b.Provider,{value:s,children:[Object(r.jsx)(x,{layoutSize:k}),Object(r.jsx)(S,{layoutSize:k,baseCanvas:n})]})})]})};i.a.render(Object(r.jsx)(o.a.StrictMode,{children:Object(r.jsx)(P,{})}),document.getElementById("root"))}},[[78,1,2]]]);
//# sourceMappingURL=main.5318361e.chunk.js.map