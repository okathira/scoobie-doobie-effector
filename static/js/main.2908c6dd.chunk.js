(this["webpackJsonpscoobie-doobie-effector"]=this["webpackJsonpscoobie-doobie-effector"]||[]).push([[0],{75:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n(4),a=n.n(c),o=n(28),i=n.n(o),u=n(10),s=n(29),d=n.n(s),l=n(9),b=Object(c.createContext)(new Map),j=Object(c.createContext)((function(){})),h=function(){return Object(c.useContext)(b)},f=function(){return Object(c.useContext)(j)},v=function(e){if(!e.current)return null;var t=e.current,n=t.getAbsoluteTransform().copy();n.invert();var r=t.getStage().getPointerPosition();return r?n.point(r):null},O=function(e){var t=e.beginPos,n=e.endPos;return Object(r.jsx)(l.c,{x:t.x,y:t.y,width:n.x-t.x,height:n.y-t.y,fill:"blue",stroke:"red",opacity:.2})},x=function(e){var t,n=e.layoutSize,a=f(),o=Object(c.useState)({x:0,y:0}),i=Object(u.a)(o,2),s=i[0],d=i[1],b=Object(c.useState)(!1),j=Object(u.a)(b,2),h=j[0],x=j[1],g=Object(c.useRef)(null),y=Object(c.useRef)(0);return Object(r.jsx)(l.d,{className:"input-area",width:n.width,height:n.height,ref:g,onMouseDown:function(){var e;d(null!==(e=v(g))&&void 0!==e?e:{x:0,y:0}),x(!0)},onMouseUp:function(){x(!1),function(){var e,t=null!==(e=v(g))&&void 0!==e?e:{x:0,y:0};a((function(e){var n=Math.min(s.x,t.x),r=Math.min(s.y,t.y),c=Math.abs(s.x-t.x)+1,a=Math.abs(s.y-t.y)+1,o={cropX:n,cropY:r,cropWidth:c,cropHeight:a,x:n+c/2,y:r+a/2,width:c,height:a,scaleX:1,scaleY:1},i=new Map(e);return i.set(y.current,o),y.current++,i}))}()},children:Object(r.jsx)(l.b,{children:h?Object(r.jsx)(O,{beginPos:s,endPos:null!==(t=v(g))&&void 0!==t?t:{x:0,y:0}}):null})})},g=n(8),y=function(e){var t,n,a=e.currentFrame,o=e.boxProps,i=e.isSelected,u=e.onSelect,s=e.onChange,d=Object(c.useRef)(null),b=Object(c.useRef)(null);return Object(c.useEffect)((function(){var e,t,n;i&&(null===(e=b.current)||void 0===e||e.nodes([d.current]),null===(t=b.current)||void 0===t||null===(n=t.getLayer())||void 0===n||n.batchDraw())}),[i]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(l.a,Object(g.a)(Object(g.a)({ref:d,onClick:u,onDragEnd:function(e){s(Object(g.a)(Object(g.a)({},o),{},{x:e.target.x(),y:e.target.y()}))},onTransformEnd:function(){var e=d.current,t=e.scaleX(),n=e.scaleY();s(Object(g.a)(Object(g.a)({},o),{},{x:e.x(),y:e.y(),scaleX:t,scaleY:n}))}},o),{},{offset:{x:(null===(t=d.current)||void 0===t?void 0:t.width())/2,y:(null===(n=d.current)||void 0===n?void 0:n.height())/2},image:a,stroke:"black",strokeWidth:10,strokeScaleEnabled:!1,draggable:!0})),i&&Object(r.jsx)(l.e,{ref:b,rotateEnabled:!1,ignoreStroke:!0,padding:5})]})},p=function(e){var t=e.currentFrame,n=e.selectedKeyState,c=Object(u.a)(n,2),a=c[0],o=c[1],i=h(),s=f();return Object(r.jsxs)(l.b,{children:[Object(r.jsx)(l.a,{image:t,onMouseDown:function(){o(void 0)}}),Array.from(i).map((function(e){var n=Object(u.a)(e,2),c=n[0],d=n[1];return Object(r.jsx)(y,{boxProps:d,currentFrame:t,isSelected:c===a,onSelect:function(){o(c)},onChange:function(e){var t=new Map(i);t.set(c,e),s(t)}},c)}))]})},w=function(e){var t=e.selectedKeyState,n=Object(u.a)(t,2),c=n[0],a=n[1],o=f(),i=function(e){if(void 0===c)return console.error("No Boxes Selected"),null;o((function(t){var n=t.get(c);if(void 0===n)return console.error("Not Found"),t;var r=e(n);return new Map(t).set(c,r)}))},s=function(e){return Object(g.a)(Object(g.a)({},e),{},{scaleX:-e.scaleX})},d=function(e){return Object(g.a)(Object(g.a)({},e),{},{scaleY:-e.scaleY})};return Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{onClick:function(){return a(void 0)},disabled:void 0===c,children:"\u9078\u629e\u89e3\u9664"}),Object(r.jsx)("button",{onClick:function(){return function(){if(void 0===c)return console.error("No Boxes Selected"),null;o((function(e){var t=new Map(e);return t.delete(c)||console.error("Not Found"),t})),a(void 0)}()},disabled:void 0===c,children:"\u524a\u9664"})]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{onClick:function(){return i(s)},disabled:void 0===c,children:"\u5de6\u53f3\u53cd\u8ee2"}),Object(r.jsx)("button",{onClick:function(){return i(d)},disabled:void 0===c,children:"\u4e0a\u4e0b\u53cd\u8ee2"})]})]})},m=function(e){var t=e.layoutSize,n=e.baseCanvas,a=h(),o=f(),i=Object(c.useState)();return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(l.d,{className:"output-area",width:t.width,height:t.height,children:Object(r.jsx)(j.Provider,{value:o,children:Object(r.jsx)(b.Provider,{value:a,children:Object(r.jsx)(p,{currentFrame:n,selectedKeyState:i})})})}),Object(r.jsx)(w,{selectedKeyState:i})]})},S=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t},C={width:1280,height:720,facingMode:"user"},M=Object(g.a)({},C),k=function(){var e=Object(c.useState)(S(M)),t=Object(u.a)(e,2),n=t[0],a=t[1],o=Object(c.useState)(new Map),i=Object(u.a)(o,2),s=i[0],l=i[1],h=Object(c.useRef)(null),f=Object(c.useRef)();return Object(c.useEffect)((function(){return f.current=setInterval((function(){return function(e){if(h.current&&h.current.video){var t=S(e).getContext("2d");if(t){t.drawImage(h.current.video,0,0);var n=t.getImageData(0,0,e.width,e.height);!function(e){for(var t=e.data.length/4,n=0;n<t;n++){var r=.299*e.data[4*n+0]+.587*e.data[4*n+1]+.114*e.data[4*n+2],c=r*r/255/255;e.data[4*n+0]=255*(c+.008),e.data[4*n+1]=255*(c+.014)+1.9,e.data[4*n+2]=255*(c+.004)}}(n),t.putImageData(n,0,0),a(t.canvas)}}}(M)}),1e3/60),function(){clearInterval(f.current)}}),[60]),Object(r.jsxs)("section",{id:"app",children:[Object(r.jsx)(d.a,{id:"camera",ref:h,audio:!1,videoConstraints:C,width:M.width,height:M.height,style:{position:"absolute"}}),Object(r.jsx)(j.Provider,{value:l,children:Object(r.jsxs)(b.Provider,{value:s,children:[Object(r.jsx)(x,{layoutSize:M}),Object(r.jsx)(m,{layoutSize:M,baseCanvas:n})]})})]})};i.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(k,{})}),document.getElementById("root"))}},[[75,1,2]]]);
//# sourceMappingURL=main.2908c6dd.chunk.js.map