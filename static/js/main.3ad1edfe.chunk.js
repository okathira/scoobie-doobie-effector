(this["webpackJsonpscoobie-doobie-effector"]=this["webpackJsonpscoobie-doobie-effector"]||[]).push([[0],{78:function(e,t,n){"use strict";n.r(t);var r=n(5),c=n(4),a=n.n(c),i=n(31),o=n.n(i),u=n(10),s=n(32),b=n.n(s),d=n(19),j=n(8),h=Object(c.createContext)([]),l=Object(c.createContext)((function(){})),f=function(){return Object(c.useContext)(h)},O=function(){return Object(c.useContext)(l)},x=function(e){if(!e.current)return null;var t=e.current,n=t.getAbsoluteTransform().copy();n.invert();var r=t.getStage().getPointerPosition();return r?n.point(r):null},v=function(e){var t=e.beginPos,n=e.endPos;return Object(r.jsx)(j.c,{x:t.x,y:t.y,width:n.x-t.x,height:n.y-t.y,fill:"blue",stroke:"red",opacity:.2})},g=function(e){var t,n=e.layoutSize,a=O(),i=Object(c.useState)({x:0,y:0}),o=Object(u.a)(i,2),s=o[0],b=o[1],h=Object(c.useState)(!1),l=Object(u.a)(h,2),f=l[0],g=l[1],y=Object(c.useRef)(null);return Object(r.jsx)(j.d,{className:"input-area",width:n.width,height:n.height,ref:y,onMouseDown:function(){var e;b(null!==(e=x(y))&&void 0!==e?e:{x:0,y:0}),g(!0)},onMouseUp:function(){!function(){var e,t=null!==(e=x(y))&&void 0!==e?e:{x:0,y:0};a((function(e){return[].concat(Object(d.a)(e),[function(){var n=Math.min(s.x,t.x),r=Math.min(s.y,t.y),c=Math.abs(s.x-t.x),a=Math.abs(s.y-t.y);return{key:e.length,cropX:n,cropY:r,cropWidth:c,cropHeight:a,x:n,y:r,width:c,height:a}}()])}))}(),g(!1)},children:Object(r.jsx)(j.b,{children:f?Object(r.jsx)(v,{beginPos:s,endPos:null!==(t=x(y))&&void 0!==t?t:{x:0,y:0}}):null})})},y=n(9),m={width:1280,height:720,facingMode:"user"},p=Object(y.a)({},m),w=function(e){var t=e.currentFrame,n=e.boxProps,a=e.isSelected,i=e.onSelect,o=e.onChange,u=Object(c.useRef)(null),s=Object(c.useRef)(null);return Object(c.useEffect)((function(){var e,t,n;a&&(null===(e=s.current)||void 0===e||e.nodes([u.current]),null===(t=s.current)||void 0===t||null===(n=t.getLayer())||void 0===n||n.batchDraw())}),[a]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(j.a,Object(y.a)(Object(y.a)({ref:u,onClick:i,onDragEnd:function(e){o(Object(y.a)(Object(y.a)({},n),{},{x:e.target.x(),y:e.target.y()}))},onTransformEnd:function(){var e=u.current,t=e.scaleX(),r=e.scaleY();e.scaleX(1),e.scaleY(1),o(Object(y.a)(Object(y.a)({},n),{},{x:e.x(),y:e.y(),width:Math.max(2,e.width()*t),height:Math.max(2,e.height()*r)}))}},n),{},{image:t,stroke:"black",strokeWidth:10,draggable:!0})),a&&Object(r.jsx)(j.e,{ref:s,boundBoxFunc:function(e,t){return t.width<2||t.height<2?e:t},rotateEnabled:!1})]})},S=function(e){var t=e.currentFrame,n=Object(c.useState)(),a=Object(u.a)(n,2),i=a[0],o=a[1],s=f(),b=O();return Object(r.jsxs)(j.b,{children:[Object(r.jsx)(j.a,{image:t,onMouseDown:function(){o(void 0)}}),s.map((function(e,n){return Object(r.jsx)(w,{boxProps:e,currentFrame:t,isSelected:e.key===i,onSelect:function(){o(e.key)},onChange:function(e){var t=Object(d.a)(s);t[n]=e,b(t)}},e.key)}))]})},P=function(e){var t=e.layoutSize,n=e.baseCanvas,c=f(),a=O();return Object(r.jsx)(j.d,{className:"output-area",width:t.width,height:t.height,children:Object(r.jsx)(l.Provider,{value:a,children:Object(r.jsx)(h.Provider,{value:c,children:Object(r.jsx)(S,{currentFrame:n})})})})},k=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t},C=function(){var e=Object(c.useState)(k(p)),t=Object(u.a)(e,2),n=t[0],a=t[1],i=Object(c.useState)([]),o=Object(u.a)(i,2),s=o[0],d=o[1],j=Object(c.useRef)(null),f=Object(c.useRef)();return Object(c.useEffect)((function(){return f.current=setInterval((function(){return function(e){if(j.current&&j.current.video){var t=k(e).getContext("2d");if(t){t.drawImage(j.current.video,0,0);var n=t.getImageData(0,0,e.width,e.height);!function(e){for(var t=e.data.length/4,n=0;n<t;n++){var r=.299*e.data[4*n+0]+.587*e.data[4*n+1]+.114*e.data[4*n+2],c=r*r/255/255;e.data[4*n+0]=255*(c+.008),e.data[4*n+1]=255*(c+.014)+1.9,e.data[4*n+2]=255*(c+.004)}}(n),t.putImageData(n,0,0),a(t.canvas)}}}(p)}),1e3/60),function(){clearInterval(f.current)}}),[60]),Object(r.jsxs)("section",{id:"app",children:[Object(r.jsx)(b.a,{id:"camera",ref:j,audio:!1,videoConstraints:m,width:p.width,height:p.height,style:{position:"absolute"}}),Object(r.jsx)(l.Provider,{value:d,children:Object(r.jsxs)(h.Provider,{value:s,children:[Object(r.jsx)(g,{layoutSize:p}),Object(r.jsx)(P,{layoutSize:p,baseCanvas:n})]})})]})};o.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(C,{})}),document.getElementById("root"))}},[[78,1,2]]]);
//# sourceMappingURL=main.3ad1edfe.chunk.js.map